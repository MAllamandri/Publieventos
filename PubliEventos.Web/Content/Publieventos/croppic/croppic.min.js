(function(n,t){Croppic=function(n,t){var r=this;r.id=n;r.obj=$("#"+n);r.outputDiv=r.obj;r.options={uploadUrl:"",uploadData:{},cropUrl:"",cropData:{},outputUrlId:"",imgEyecandy:!0,imgEyecandyOpacity:.2,zoomFactor:10,rotateFactor:5,doubleZoomControls:!0,rotateControls:!0,modal:!1,customUploadButtonId:"",loaderHtml:"",scaleToFill:!0,processInline:!1,loadPicture:"",onReset:null,enableMousescroll:!1,onBeforeImgUpload:null,onAfterImgUpload:null,onImgDrag:null,onImgZoom:null,onImgRotate:null,onBeforeImgCrop:null,onAfterImgCrop:null,onBeforeRemoveCroppedImg:null,onAfterRemoveCroppedImg:null,onError:null};for(i in t)r.options[i]=t[i];r.init()};Croppic.prototype={id:"",imgInitW:0,imgInitH:0,imgW:0,imgH:0,objW:0,objH:0,actualRotation:0,windowW:0,windowH:$(n).height(),obj:{},outputDiv:{},outputUrlObj:{},img:{},defaultImg:{},croppedImg:{},imgEyecandy:{},form:{},iframeform:{},iframeobj:{},cropControlsUpload:{},cropControlsCrop:{},cropControlZoomMuchIn:{},cropControlZoomMuchOut:{},cropControlZoomIn:{},cropControlZoomOut:{},cropControlCrop:{},cropControlReset:{},cropControlRemoveCroppedImage:{},modal:{},loader:{},init:function(){var n=this;n.objW=n.obj.width();n.objH=n.obj.height();n.actualRotation=0;$.isEmptyObject(n.defaultImg)&&(n.defaultImg=n.obj.find("img"));n.createImgUploadControls();$.isEmptyObject(n.options.loadPicture)?n.bindImgUploadControl():n.loadExistingImage()},createImgUploadControls:function(){var n=this,t="",i,r;n.options.customUploadButtonId===""&&(t='<i class="cropControlUpload"><\/i>');i='<i class="cropControlRemoveCroppedImage"><\/i>';$.isEmptyObject(n.croppedImg)&&(i="");$.isEmptyObject(n.options.loadPicture)||(t="");r='<div class="cropControls cropControlsUpload"> '+t+i+" <\/div>";n.outputDiv.append(r);n.cropControlsUpload=n.outputDiv.find(".cropControlsUpload");n.options.customUploadButtonId===""?n.imgUploadControl=n.outputDiv.find(".cropControlUpload"):(n.imgUploadControl=$("#"+n.options.customUploadButtonId),n.imgUploadControl.show());$.isEmptyObject(n.croppedImg)||(n.cropControlRemoveCroppedImage=n.outputDiv.find(".cropControlRemoveCroppedImage"))},bindImgUploadControl:function(){var n=this,r='<form class="'+n.id+'_imgUploadForm" style="display: none; visibility: hidden;">  <input type="file" name="img" id="'+n.id+'_imgUploadField">  <\/form>',i;n.outputDiv.append(r);n.form=n.outputDiv.find("."+n.id+"_imgUploadForm");i=n.CreateFallbackIframe();n.imgUploadControl.off("click");n.imgUploadControl.on("click",function(){i===""?n.form.find('input[type="file"]').trigger("click"):n.iframeform.find('input[type="file"]').trigger("click")});if(!$.isEmptyObject(n.croppedImg))n.cropControlRemoveCroppedImage.on("click",function(){typeof n.options.onBeforeRemoveCroppedImg==typeof Function&&n.options.onBeforeRemoveCroppedImg.call(n);n.croppedImg.remove();$(this).hide();typeof n.options.onAfterRemoveCroppedImg==typeof Function&&n.options.onAfterRemoveCroppedImg.call(n);$.isEmptyObject(n.defaultImg)||n.obj.append(n.defaultImg);n.options.outputUrlId!==""&&$("#"+n.options.outputUrlId).val("")});n.form.find('input[type="file"]').change(function(){var r,i;if(n.options.onBeforeImgUpload&&n.options.onBeforeImgUpload.call(n),n.showLoader(),n.imgUploadControl.hide(),n.options.processInline)r=new FileReader,r.onload=function(t){var i=new Image;i.src=t.target.result;i.onload=function(){n.imgInitW=n.imgW=i.width;n.imgInitH=n.imgH=i.height;n.options.modal&&n.createModal();$.isEmptyObject(n.croppedImg)||n.croppedImg.remove();n.imgUrl=i.src;n.obj.append('<img src="'+i.src+'">');n.initCropper();n.hideLoader();n.options.onAfterImgUpload&&n.options.onAfterImgUpload.call(n)}},r.readAsDataURL(n.form.find('input[type="file"]')[0].files[0]);else{formData=new FormData(n.form[0]);for(i in n.options.uploadData)n.options.uploadData.hasOwnProperty(i)&&formData.append(i,n.options.uploadData[i]);$.ajax({url:n.options.uploadUrl,data:formData,context:t.body,cache:!1,contentType:!1,processData:!1,type:"POST"}).always(function(t){n.afterUpload(t)})}})},loadExistingImage:function(){var n=this,t;if($.isEmptyObject(n.croppedImg))n.options.onBeforeImgUpload&&n.options.onBeforeImgUpload.call(n),n.showLoader(),n.options.modal&&n.createModal(),$.isEmptyObject(n.croppedImg)||n.croppedImg.remove(),n.imgUrl=n.options.loadPicture,t=$('<img src="'+n.options.loadPicture+'">'),n.obj.append(t),t.load(function(){n.imgInitW=n.imgW=this.width;n.imgInitH=n.imgH=this.height;n.initCropper();n.hideLoader();n.options.onAfterImgUpload&&n.options.onAfterImgUpload.call(n)});else n.cropControlRemoveCroppedImage.on("click",function(){n.croppedImg.remove();$(this).hide();$.isEmptyObject(n.defaultImg)||n.obj.append(n.defaultImg);n.options.outputUrlId!==""&&$("#"+n.options.outputUrlId).val("");n.croppedImg="";n.reset()})},afterUpload:function(n){var t=this,i;response=typeof n=="object"?n:jQuery.parseJSON(n);response.status=="success"&&(t.imgInitW=t.imgW=response.width,t.imgInitH=t.imgH=response.height,t.options.modal&&t.createModal(),$.isEmptyObject(t.croppedImg)||t.croppedImg.remove(),t.imgUrl=response.url,i=$('<img src="'+response.url+'">'),t.obj.append(i),i.load(function(){t.initCropper();t.hideLoader();t.options.onAfterImgUpload&&t.options.onAfterImgUpload.call(t)}),t.options.onAfterImgUpload&&t.options.onAfterImgUpload.call(t));response.status=="error"&&(t.options.onError&&t.options.onError.call(t,response.message),t.hideLoader(),setTimeout(function(){t.reset()},2e3))},createModal:function(){var n=this,t=n.windowH/2-n.objH/2,i='<div id="croppicModal"><div id="croppicModalObj" style="width:'+n.objW+"px; height:"+n.objH+"px; margin:0 auto; margin-top:"+t+'px; position: relative;"> <\/div><\/div>';$("body").append(i);n.modal=$("#croppicModal");n.obj=$("#croppicModalObj")},destroyModal:function(){var n=this;n.obj=n.outputDiv;n.modal.remove();n.modal={}},initCropper:function(){var n=this;n.img=n.obj.find("img");n.img.wrap('<div class="cropImgWrapper" style="overflow:hidden; z-index:1; position:absolute; width:'+n.objW+"px; height:"+n.objH+'px;"><\/div>');n.createCropControls();n.options.imgEyecandy&&n.createEyecandy();n.initDrag();n.initialScaleImg()},createEyecandy:function(){var n=this;n.imgEyecandy=n.img.clone();n.imgEyecandy.css({"z-index":"0",opacity:n.options.imgEyecandyOpacity}).appendTo(n.obj)},destroyEyecandy:function(){var n=this;n.imgEyecandy.remove()},initialScaleImg:function(){var n=this;if(n.zoom(-n.imgInitW),n.zoom(40),n.options.enableMousescroll)n.img.on("mousewheel",function(t){t.preventDefault();n.zoom(n.options.zoomFactor*t.deltaY)});n.img.css({left:-(n.imgW-n.objW)/2,top:-(n.imgH-n.objH)/2,position:"relative"});n.options.imgEyecandy&&n.imgEyecandy.css({left:-(n.imgW-n.objW)/2,top:-(n.imgH-n.objH)/2,position:"relative"})},createCropControls:function(){var n=this,t="",i="",r="",u="",f;if(n.options.doubleZoomControls&&(t='<i class="cropControlZoomMuchIn"><\/i>',i='<i class="cropControlZoomMuchOut"><\/i>'),n.options.rotateControls&&(r='<i class="cropControlRotateLeft"><\/i>',u='<i class="cropControlRotateRight"><\/i>'),f='<div class="cropControls cropControlsCrop">'+t+'<i class="cropControlZoomIn"><\/i><i class="cropControlZoomOut"><\/i>'+i+r+u+'<i class="cropControlCrop"><\/i><i class="cropControlReset"><\/i><\/div>',n.obj.append(f),n.cropControlsCrop=n.obj.find(".cropControlsCrop"),n.options.doubleZoomControls){n.cropControlZoomMuchIn=n.cropControlsCrop.find(".cropControlZoomMuchIn");n.cropControlZoomMuchIn.on("click",function(){n.zoom(n.options.zoomFactor*10)});n.cropControlZoomMuchOut=n.cropControlsCrop.find(".cropControlZoomMuchOut");n.cropControlZoomMuchOut.on("click",function(){n.zoom(-n.options.zoomFactor*10)})}n.cropControlZoomIn=n.cropControlsCrop.find(".cropControlZoomIn");n.cropControlZoomIn.on("click",function(){n.zoom(n.options.zoomFactor)});n.cropControlZoomOut=n.cropControlsCrop.find(".cropControlZoomOut");n.cropControlZoomOut.on("click",function(){n.zoom(-n.options.zoomFactor)});n.cropControlZoomIn=n.cropControlsCrop.find(".cropControlRotateLeft");n.cropControlZoomIn.on("click",function(){n.rotate(-n.options.rotateFactor)});n.cropControlZoomOut=n.cropControlsCrop.find(".cropControlRotateRight");n.cropControlZoomOut.on("click",function(){n.rotate(n.options.rotateFactor)});n.cropControlCrop=n.cropControlsCrop.find(".cropControlCrop");n.cropControlCrop.on("click",function(){n.crop()});n.cropControlReset=n.cropControlsCrop.find(".cropControlReset");n.cropControlReset.on("click",function(){n.reset()})},initDrag:function(){var t=this;t.img.on("mousedown touchstart",function(i){var u,f,r;i.preventDefault();r=n.navigator.userAgent;r.match(/iPad/i)||r.match(/iPhone/i)||r.match(/android/i)?(u=i.originalEvent.touches[0].pageX,f=i.originalEvent.touches[0].pageY):(u=i.pageX,f=i.pageY);var c=t.img.css("z-index"),e=t.img.outerHeight(),o=t.img.outerWidth(),s=t.img.offset().top+e-f,h=t.img.offset().left+o-u;t.img.css("z-index",1e3).on("mousemove touchmove",function(n){var f,l,i,u;r.match(/iPad/i)||r.match(/iPhone/i)||r.match(/android/i)?(f=n.originalEvent.touches[0].pageY+s-e,l=n.originalEvent.touches[0].pageX+h-o):(f=n.pageY+s-e,l=n.pageX+h-o);t.img.offset({top:f,left:l}).on("mouseup",function(){$(this).removeClass("draggable").css("z-index",c)});t.options.imgEyecandy&&t.imgEyecandy.offset({top:f,left:l});t.objH<t.imgH?(parseInt(t.img.css("top"))>0&&(t.img.css("top",0),t.options.imgEyecandy&&t.imgEyecandy.css("top",0)),i=-(t.imgH-t.objH),parseInt(t.img.css("top"))<i&&(t.img.css("top",i),t.options.imgEyecandy&&t.imgEyecandy.css("top",i))):(parseInt(t.img.css("top"))<0&&(t.img.css("top",0),t.options.imgEyecandy&&t.imgEyecandy.css("top",0)),i=t.objH-t.imgH,parseInt(t.img.css("top"))>i&&(t.img.css("top",i),t.options.imgEyecandy&&t.imgEyecandy.css("top",i)));t.objW<t.imgW?(parseInt(t.img.css("left"))>0&&(t.img.css("left",0),t.options.imgEyecandy&&t.imgEyecandy.css("left",0)),u=-(t.imgW-t.objW),parseInt(t.img.css("left"))<u&&(t.img.css("left",u),t.options.imgEyecandy&&t.imgEyecandy.css("left",u))):(parseInt(t.img.css("left"))<0&&(t.img.css("left",0),t.options.imgEyecandy&&t.imgEyecandy.css("left",0)),u=t.objW-t.imgW,parseInt(t.img.css("left"))>u&&(t.img.css("left",u),t.options.imgEyecandy&&t.imgEyecandy.css("left",u)));t.options.onImgDrag&&t.options.onImgDrag.call(t)})}).on("mouseup",function(){t.img.off("mousemove")}).on("mouseout",function(){t.img.off("mousemove")})},rotate:function(n){var t=this;t.actualRotation+=n;t.img.css({"-webkit-transform":"rotate("+t.actualRotation+"deg)","-moz-transform":"rotate("+t.actualRotation+"deg)",transform:"rotate("+t.actualRotation+"deg)"});t.options.imgEyecandy&&t.imgEyecandy.css({"-webkit-transform":"rotate("+t.actualRotation+"deg)","-moz-transform":"rotate("+t.actualRotation+"deg)",transform:"rotate("+t.actualRotation+"deg)"});typeof t.options.onImgRotate=="function"&&t.options.onImgRotate.call(t)},zoom:function(n){var t=this,e=t.imgW/t.imgH,i=t.imgW+n,r=i/e,o=!0,u,f,s,h;(i<t.objW||r<t.objH)&&(i-t.objW<r-t.objH?(i=t.objW,r=i/e):(r=t.objH,i=e*r),o=!1);!t.options.scaleToFill&&(i>t.imgInitW||r>t.imgInitH)&&(i-t.imgInitW<r-t.imgInitH?(i=t.imgInitW,r=i/e):(r=t.imgInitH,i=e*r),o=!1);t.imgW=i;t.img.width(i);t.imgH=r;t.img.height(r);u=parseInt(t.img.css("top"))-n/2;f=parseInt(t.img.css("left"))-n/2;u>0&&(u=0);f>0&&(f=0);s=-(r-t.objH);u<s&&(u=s);h=-(i-t.objW);f<h&&(f=h);o&&t.img.css({top:u,left:f});t.options.imgEyecandy&&(t.imgEyecandy.width(i),t.imgEyecandy.height(r),o&&t.imgEyecandy.css({top:u,left:f}));t.options.onImgZoom&&t.options.onImgZoom.call(t)},crop:function(){var n=this,u,f,i;if(n.options.onBeforeImgCrop&&n.options.onBeforeImgCrop.call(n),n.cropControlsCrop.hide(),n.showLoader(),u={imgUrl:n.imgUrl,imgInitW:n.imgInitW,imgInitH:n.imgInitH,imgW:Math.abs(parseInt(n.imgW)),imgH:Math.abs(parseInt(n.imgH)),imgY1:Math.abs(parseInt(n.img.css("top"))),imgX1:Math.abs(parseInt(n.img.css("left"))),cropH:Math.abs(parseInt(n.objH)),cropW:Math.abs(parseInt(n.objW)),rotation:n.actualRotation},typeof FormData=="undefined"){var r=new XMLHttpRequest,e="",o=[];for(i in u)o.push(encodeURIComponent(i)+"="+encodeURIComponent(u[i]));for(i in n.options.cropData)o.push(encodeURIComponent(i)+"="+encodeURIComponent(n.options.cropData[i]));e=o.join("&").replace(/%20/g,"+");r.addEventListener("error",function(){n.options.onError&&n.options.onError.call(n,"XHR Request failed")});r.onreadystatechange=function(){r.readyState==4&&r.status==200&&n.afterCrop(r.responseText)};r.open("POST",n.options.cropUrl);r.setRequestHeader("Content-Type","application/x-www-form-urlencoded");r.setRequestHeader("Content-Length",e.length);r.send(e)}else{f=new FormData;for(i in u)u.hasOwnProperty(i)&&f.append(i,u[i]);for(i in n.options.cropData)n.options.cropData.hasOwnProperty(i)&&f.append(i,n.options.cropData[i]);$.ajax({url:n.options.cropUrl,data:f,context:t.body,cache:!1,contentType:!1,processData:!1,type:"POST"}).always(function(t){n.afterCrop(t)})}},afterCrop:function(n){var t=this;try{response=jQuery.parseJSON(n)}catch(i){response=typeof n=="object"?n:jQuery.parseJSON(n)}response.status=="success"&&(t.options.imgEyecandy&&t.imgEyecandy.hide(),t.destroy(),t.obj.append('<img class="croppedImg" src="'+response.url+'">'),t.options.outputUrlId!==""&&$("#"+t.options.outputUrlId).val(response.url),t.croppedImg=t.obj.find(".croppedImg"),t.init(),t.hideLoader());response.status=="error"&&(t.options.onError&&t.options.onError.call(t,response.message),t.hideLoader(),setTimeout(function(){t.reset()},2e3));t.options.onAfterImgCrop&&t.options.onAfterImgCrop.call(t)},showLoader:function(){var n=this;n.obj.append(n.options.loaderHtml);n.loader=n.obj.find(".loader")},hideLoader:function(){var n=this;n.loader.remove()},reset:function(){var n=this;n.destroy();n.init();$.isEmptyObject(n.croppedImg)||(n.obj.append(n.croppedImg),n.options.outputUrlId!==""&&$("#"+n.options.outputUrlId).val(n.croppedImg.attr("url")));typeof n.options.onReset=="function"&&n.options.onReset.call(n)},destroy:function(){var n=this;n.options.modal&&!$.isEmptyObject(n.modal)&&n.destroyModal();n.options.imgEyecandy&&!$.isEmptyObject(n.imgEyecandy)&&n.destroyEyecandy();$.isEmptyObject(n.cropControlsUpload)||n.cropControlsUpload.remove();$.isEmptyObject(n.cropControlsCrop)||n.cropControlsCrop.remove();$.isEmptyObject(n.loader)||n.loader.remove();$.isEmptyObject(n.form)||n.form.remove();n.obj.html("")},isAjaxUploadSupported:function(){var n=t.createElement("input");return n.type="file","multiple"in n&&typeof File!="undefined"&&typeof FormData!="undefined"&&typeof(new XMLHttpRequest).upload!="undefined"},CreateFallbackIframe:function(){var n=this,i,u,r;if(n.isAjaxUploadSupported())return"";jQuery.isEmptyObject(n.iframeobj)?(i=t.createElement("iframe"),i.setAttribute("id",n.id+"_upload_iframe"),i.setAttribute("name",n.id+"_upload_iframe"),i.setAttribute("width","0"),i.setAttribute("height","0"),i.setAttribute("border","0"),i.setAttribute("src","javascript:false;"),i.style.display="none",t.body.appendChild(i)):i=n.iframeobj[0];u='<!DOCTYPE html><html><head><title>Uploading File<\/title><\/head><body><form class="'+n.id+'_upload_iframe_form" name="'+n.id+'_upload_iframe_form" action="'+n.options.uploadUrl+'" method="post" enctype="multipart/form-data" encoding="multipart/form-data" style="display:none;">'+$("#"+n.id+"_imgUploadField")[0].outerHTML+"<\/form><\/body><\/html>";i.contentWindow.document.open("text/htmlreplace");i.contentWindow.document.write(u);i.contentWindow.document.close();n.iframeobj=$("#"+n.id+"_upload_iframe");n.iframeform=n.iframeobj.contents().find("html").find("."+n.id+"_upload_iframe_form");n.iframeform.on("change","input",function(){n.SubmitFallbackIframe(n)});return n.iframeform.find("input")[0].attachEvent("onchange",function(){n.SubmitFallbackIframe(n)}),r=function(){i.detachEvent?i.detachEvent("onload",r):i.removeEventListener("load",r,!1);var t=n.getIframeContentJSON(i);jQuery.isEmptyObject(n.modal)&&n.afterUpload(t)},i.addEventListener&&i.addEventListener("load",r,!0),i.attachEvent&&i.attachEvent("onload",r),"#"+n.id+"_imgUploadField"},SubmitFallbackIframe:function(n){n.showLoader();n.options.processInline&&!n.options.uploadUrl?n.options.onError&&(n.options.onError.call(n,"processInline is not supported by your browser "),n.hideLoader()):(n.options.onBeforeImgUpload&&n.options.onBeforeImgUpload.call(n),n.iframeform[0].submit())},getIframeContentJSON:function(n){try{var r=n.contentDocument?n.contentDocument:n.contentWindow.document,i,t=r.body.innerHTML;t.slice(0,5).toLowerCase()=="<pre>"&&t.slice(-6).toLowerCase()=="<\/pre>"&&(t=r.body.firstChild.firstChild.nodeValue);i=jQuery.parseJSON(t)}catch(u){i={success:!1}}return i}}})(window,document);
/*
//# sourceMappingURL=croppic.min.js.map
*/